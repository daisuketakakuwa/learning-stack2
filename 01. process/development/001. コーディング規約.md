## コーディング規約 is 何
・**コードをどう書くか**の話。<br/><br/>
・可読性(readablity) と 保守性(maintainability) をあげるためのルール。<br/><br/>
👉特に【**保守性＝質**】であり、可読性があがることで保守性があがるものもあるので<br/>
 　【**コーディング規約は保守性UPに収束する**】という認識でいよう。


- 可読性
  - 複数のメンバーで開発していても、書き方が統一されているから読みやすい。
  - 人が入れ替わっても、書き方が統一されているから読みやすい。
  - 一度開発してしばらく見てないコードでも、書き方が統一されているから読みやすい。

- 保守性(質)
  - テストがちゃんと書いてある＝変なバグが埋め込まれたら確実にエラー検知される👍
  - IF噛ませてOpenClosedにする＝既存コードに手が加わらない形＝既存機能にエラーが埋め込まれない👍
  - ビジネスロジックの定義場所が決まっている＝意図しないところに要件が埋め込まれないように👍

つまり🔴🔴🔴**コーディング規約を定める＝上記のようなことを実現するためのルールを定める**🔴🔴🔴である。

## BE（WebAPI）コーディング規約

観点がいろいろあるから、カテゴリ分けしていく。

①構造/レイヤー設計<br/>
②設計原則<br/>
③コードスタイル<br/>
④DBアクセス方針<br/>

### ①構造/レイヤー設計
- プロジェクト/パッケージ構成
  - レイヤードアーキテクチャ
    - 依存の矢印は一方通行（Controller→Service→Repository)  
  - 各クラスの責務
    - Controller
    - Service
    - Repository
    - DTO
      - 名前の通り、データを運ぶためだけの入れ物クラス(Data Transfer Object)
      - レイヤー/ネットワーク(ブラウザ⇔サーバ)間を流れる
      - IFとなるRequestクラス/ResponseクラスはDTOである。
      - Serializable
      - DBで永続化/保存されないもの。
    - Entity
      - DBで永続化/保存されるもの。
      - 一意性を持つもの。
      - 登録/更新処理を行う際に用いる。
      - EntityはController層からは参照しない。
    - VO
      - 

### ②設計原則
- REST API設計
  - 適切なHTTPメソッドを使えているか(GET/POST/PUT/PATCH/DELETE/HEAD)
  - 適切なパラメータ設計(リクエストボディ/リクエストパラメータ/パスパラメータ)
- 抽象化
  - 外部プロバイダ(例:AWS)に依存する処理は、IFを噛ませることでAWSに依存させない形にする(もしAWSからGCPに切り替えることがあってもDIするクラスをAWS実装クラス→GCP実装クラスへ変更するだけでOK👍）
- デザインパターン
  - SRP/単一責任の原則（各メソッドの責務は１つにしよう） 
- エラーハンドリング
- ビジネスロジックはModelに集約しよう
- バリデーション方針
  - SpringBoot提供のバリデーション機能(@Validated, @Valid)の利用禁止
- 検索処理
  - ページングを使おう
  - データ検索結果が0件の場合
    - 取得（findOne）結果が0件の場合、ResourcerNotFoundExceptionを投げる。
    - 検索（findAll）結果が0件の場合、空Listを返却する。
- ファイル処理

### ③コードスタイル
- マジックナンバーを使わない
```kt
// 悪い例
public double calculateDiscount(double price) {
    return price * 0.1;  // 0.1 の意味が不明
}

// 良い例
private static final double DISCOUNT_RATE = 0.1;  // 0.1の意味が分かる

public double calculateDiscount(double price) {
    return price * DISCOUNT_RATE;
}
```
- varの使用禁止など
- 命名規約
  - Repository層
    - 唯一の結果を取得するメソッド → findOne｜getをprefixに
    - 保存系のメソッド → saveを使う。insertは使わない（永続化層を隠蔽する/連想させない)
    - 
### ④DBアクセス方針
- DB操作時のトランザクション制御
  - Service層をトランザクション境界とする。
  - カスタムTransactionalアノテーション(`@DbTransactional`)をクラスに付与する。
    - 素の`@Transactional`を使うとロールバック設定(`rollbackFor`属性)が漏れる可能性があるため。 
- DBに対する操作はギリギリまで行わない
  - DBに対する更新系/取得系の操作は、必要になる直前まで実行しない。
  - コードの見通しを良くしたいのと、ロールバック時に不必要なDB操作までロールバック対象としたくない。
- DB操作時の排他制御
  - 楽観ロックもしない？？
- DB保存/更新系のRepositoryメソッドの戻り値は判定に使わない。
- 外部API呼び出し


