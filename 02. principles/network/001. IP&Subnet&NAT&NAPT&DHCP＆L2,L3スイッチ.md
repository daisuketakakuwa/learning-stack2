# 家庭のネットワーク構成
<img width="700px" src="https://storage.googleapis.com/zenn-user-upload/e632b99248cc-20230601.png" />

✅インターネットを利用するときは皆１つのPublicIPアドレスを使う。 <br>
✅マンション全体で１つのLANを利用している。<br>

<img width="700px" src="https://storage.googleapis.com/zenn-user-upload/48bcda95e030-20230610.png" />

# IP Address
IP version 4 (IPv4) – the IP address is a **32-bit number** (from 0 to 4,294,967,295)

The address is written as **4 separate bytes**, called **octets**

> バイト→普通は8ビットだよ(7ビット/9ビットのときもあるらしい)
オクテット(**octet**)→必ず8ビットだよ

IPアドレス = 第1オクテット.第2オクテット.第3オクテット.第4オクテット

00001111.00001111.00001111.00001111【2進数】
　↓
15.15.15.15【10進数】

> 2進数（Binary number） 10進数（Decimal number） 16進数（Hexadecimal number）

組み合わせは 2^8(256) ✕ 2^8(256) ✕ 2^8(256) ✕ 2^8(256) = ***2^32 = 43億個* 

# Subnet Mask
これを使うことで、１つのIPアドレスで **①ネットワークのIPアドレス** と **②ホストのIPアドレス"部分"** を表示することが可能。

> 2進数表記で「1」の部分がネットワーク部だよ
2進数表記で「0」の部分がホスト部だよ

IPアドレスが「192.168.0.2」で、サブネット(マスク)が「255.255.255.0」or「/24」の場合<br>
・ネットワークのIPアドレスは「192.168.0.0」<br>
・ホストのIPアドレスは「192.168.0.2」<br>
なんだなと分かる。　

# いつ/なんでSubnet使うん？
LAN内の各端末にPrivateIPアドレスを割り振りたい。<br>
→ ネットワークIPアドレスを確定させたい<br>
→ サブネットを定義することで、皆同じネットワーク部をもつIPアドレスにする。

という流れ。**サブネットやデフォルトゲートウェイはDHCPサーバに設定する**のだが、家庭用のブロードバンドルータ搭載のDHCPサーバ機能は自動で設定してくれるから、今まで気にする必要がなかった。

今使ってるポケットWiFi(BroadWiMax)に、Surface、iPhone、Macの3端末繋げてみて、各端末からPrivateIPとサブネットを調べてみた。

|端末|PrivateIP|サブネット|
|----|----|----|
|iPhone|192.168.162.**46**|255.255.255.0|
|Mac|192.168.162.**219**|255.255.255.0|
|Surface|192.168.162.**68**|255.255.255.0|

🔴**サブネットは同じ＆ネットワーク部も同じだった**👍<br>
✅**デフォルトゲートウェイ＝ルータのPrivateIPアドレス**なのも納得👍<br>

<img width="500px" src="https://storage.googleapis.com/zenn-user-upload/a5cc0069a496-20230531.png" />

<img width="400px" src="https://storage.googleapis.com/zenn-user-upload/cb4c53b743f7-20230531.png" />

<img width="400px" src="https://storage.googleapis.com/zenn-user-upload/7a3cd633d804-20230531.png" />


# デフォルトゲートウェイ(0.0.0.0/ラストリゾート)
> ネットワークの出入口だよ = **ルータのことや**
**お届け先が分からないときに取りあえず送る先**だよ
**デフォルトゲートウェイに送られたデータは別のネットワークに流れていく**

> L3SWやルータにデフォルトゲートウェイの値を設定する際、**「0.0.0.0」のアドレスを指定する場合があります。この値は「ラストリゾート」と呼ばれています。**
> ラストリゾートの「0.0.0.0」は簡単に表現すると「その他大勢のネットワーク」となります。通常、**ラストリゾートの転送先はプロバイダのIPアドレスとなります。**
参考：[【初心者用】デフォルトゲートウェイの役割と設定方法](https://ict-skillup.com/network/504/)

ネットワークってのは、つまりLAN(ルータ)のことだ。<br>
世界中で皆がLANを立てて、LAN同士でやり取りしようとすると簡単に43億個なんてなくなりそうじゃない？と。

**企業内部だけでやり取りするなら、別にパブリックIP不要じゃない？**

そう。たとえばLAN1(PrivateIP: 172.16.0.0/24)があったとしよう。<br>
そんでLAN内に２つのPCがあるとしよう。<br>
・PC1(PrivateIP: 172.16.0.1)<br>
・PC2(PrivateIP: 172.16.0.2)<br>
同じネットワーク(172.16.0.X)内なので、LAN内だけのやり取りで完結だ。

# セグメント(ブロードキャストドメイン)
ルータにネットワークIPアドレスが付与されて、そいつがデフォルトゲートウェイ(外部NWへの玄関)なのは分かった。では、セグメントとかL2スイッチはここにどう紐づいてくるのだろう？

セグメントとは<br>
🔴同じLAN/ネットワークの中でも、部署ごとにファイルサーバを配置して参照させるような構成にしたい場合、ネットワークAの中に部署ごとのサブネットワークも欲しい。こんなときにセグメント(L2)で分割する。<br>
<br>
１．アプリケーションデータ（IPパケット含む）をプログラムで作成する。<br>
２．IPパケット内にある宛先PCを参照<br>
３．宛先PCのIPアドレスが同一セグメントにあるか（同じサブネットか）どうか確認<br>
　　同一である場合（データリンク層のみのルーティング）<br>
　　　・ARPでMACアドレスを取得し、MACフレームを送信する<br>
　　異なる場合（ルータを介してIPアドレスを使ってルーティングを行う）<br>
　　　・1のIPパケットをそのままデフォルトゲートウェイへ転送する<br>
<br>
✅ セグメント内であれば"**イーサネットフレーム**/**MACフレーム**"が直接届く範囲<br>
　→ 宛先が異なるセグメントの場合、ルーターを介して届ける必要がある。<br>

🔴**L2スイッチにネットワークIPアドレスは割り振られない。**<br>
🔴L2スイッチは、セグメント作成用のハブであって、**ハブ自体にIPアドレスはない。**<br>
✅ルータは、ネットワークIPアドレスがついている。<br>
✅各セグメント内にあるPCには、サブネットに沿ってそれぞれネットワーク部を異なるものに設定するだけ。<br>
✅セグメント間＝ネットワーク間なので、ルータを介する必要がある。

<img width="700px" src="https://storage.googleapis.com/zenn-user-upload/c9ca6638611a-20230601.png" />

<img width="700px" src="https://storage.googleapis.com/zenn-user-upload/f5498cb153d7-20230601.png" />


# DHCPサーバへPrivateIPを問い合わせる仕組み
<img width="700px" src="https://storage.googleapis.com/zenn-user-upload/ecbf8551ce75-20230610.png" />


# Address Class(Public IPとPrivate IPの範囲)
Address Classという**分類方法**がある。<br>
🔴PrivateIPは他のLAN内でも同じものが使われている可能性があるが？<br>
✅NATでPublicIPに変換するから問題ない。<br>
🔴PrivateIPとPublicIPで分けている理由は？

||Private IP range|Public IP range|ネットマスク|
|----|----|----|----|
|ClassA|10.0.0.0～10.255.255.255|0.0.0.0～9.255.255.255<br>11.0.0.0～127.255.255.255|255.0.0.0|
|ClassB|172.16.0.0～172.31.255.255|127.0.0.0～172.15.255.255<br>172.32.0.0～191.255.255.255|255.255.0.0|
|ClassC|192.168.0.0～192.168.255.255|192.0.0.0～192.167.0.0<br>192.169.0.0～223.255.255.255|255.255.255.0|

<img width="500px" src="https://storage.googleapis.com/zenn-user-upload/8e5bd9a771ab-20230531.png" />

https://atmarkit.itmedia.co.jp/ait/articles/0301/17/news003.html

各クラスでデフォルトのネットマスクが決まっている＝表現できるネットワーク数/ホスト数がきまっている。クラスA → Cにかけてホスト数が減っていく。

<img width="500px" src="https://storage.googleapis.com/zenn-user-upload/f8cf0a8e807c-20230531.png" />

