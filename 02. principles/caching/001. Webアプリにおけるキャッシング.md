# Special Thanks
- [Database Caching for System Design Interviews](https://www.youtube.com/watch?v=6GY1akbxyEo)
- [Redisã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã¤ã„ã¦ç†è§£ã‚’æ·±ã‚ã¦ã¿ãŸã€‚](https://qiita.com/Shiruba/items/7810a686d8510fd1555a#keydb)

# What is caching?
Caching is a data storage technique that plays an essential role **in designing SCALABLE internet application**.<br>
âœ…ScalableãªWEBã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã†ãˆã§ã¯æ¬ ã‹ã›ãªã„è¦ç´ ã€‚

Cache is any data store that can store and retrieve data quickly for future use.

# Without caching?
Without caching, computers and internet would be impossibly slow due to the access time of retrieving data at every step.

# ãƒ¬ã‚¤ãƒ¤ã”ã¨ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ©ç”¨ä¾‹
ãƒ¬ã‚¤ãƒ¤ã”ã¨ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®åˆ©ç”¨ä¾‹ãŒåˆ†ã‹ã‚Œã¦ã„ã‚‹ã€‚<br>
ã€€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**<br>
ã€€ã€€01. ã‚ˆãã‚ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥(é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„)<br>
ã€€**Webã‚µãƒ¼ãƒ**<br>
ã€€ã€€02. é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€CDNã€‘<br>
ã€€ã€€03. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†(èªè¨¼æ¸ˆæƒ…å ±ã€è²·ã„ç‰©ã‹ã”æ©Ÿèƒ½)ã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã€‘<br>
ã€€**API**<br>
ã€€ã€€04. å–å¾—ç³»SQLã®å®Ÿè¡Œçµæœä¿ç®¡ã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã€‘

![](https://storage.googleapis.com/zenn-user-upload/8c04f2f866b1-20230104.png)

# Database Caching

## O1. ğŸ‘In-memory application cache/application's memory
Each Server must maintain its own cache which increases memory demands the cost of the system.
## O2. ğŸ‘Distributed in-memory cacheã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã€‘
A separate caching server **such as memcache or redis**.<br>
In this way, multiple application servers can read and write from **the same** cache.
## 03. ğŸ‘File system cacheã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥/CDNã€‘
CDN is a example of a distributed file system cache which **takes advantage of geographic locality caching**.

# Points when using caching
## Cache coherence / Data Accuracyã€ã©ã†ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€è²«ã•ã›ã‚‹ã‹ã€‘
âœ…è¤‡æ•°ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã‚’çµ„ã¿åˆã‚ã›ã¦ä½¿ã£ãŸã‚Šã€TTLã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ã‚’å®Ÿç¾ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚<br>
âœ…**æˆ¦ç•¥1ï¼‹æˆ¦ç•¥2ã‹æˆ¦ç•¥3ï¼‹TTLã®é•·ã•è¨­å®š**

### æˆ¦ç•¥1: Read-through / Cache-aside / Lazy-loading
Cache-aside loads data into the cache on-demand.<br>
âœ…ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒãªã‘ã‚Œã°ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ã•ã‚Œãªã„æ–¹å¼ã€‚<br>
âœ…ã¾ãšã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰ç„¡ç¢ºèªã€‚ãªã‘ã‚Œã°ãƒ¡ãƒ¢ãƒªã«å–ã‚Šã«è¡Œãã€‚ã‚ã‚Œã°ãã®ã¾ã¾è¿”ã™ã€‚

### æˆ¦ç•¥2: Write-through cache
A write-through cache updates the cache and main memory simultaneously meaning that  there's no chance either can go out of date.<br>
ğŸ‘Always keep them coherent between main memory and cache.<br>
ğŸ‘We have to wait for updating to cache memory so that it's later than write-behind.<br>
âœ…ãƒ¡ãƒ¢ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¸åŒæ™‚æ›¸ãè¾¼ã¿ã‚’è¡Œã†ã€‚<br>
âœ…æ›´æ–°å‡¦ç†ã®ãŸã³ã«**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«å¯¾ã™ã‚‹æ›´æ–°å‡¦ç†ã‚‚å¾…ã¤å¿…è¦ãŒã‚ã‚‹ã€‚**

### æˆ¦ç•¥3: Write-behind cache
A write-behind cache update memory asynchronously.<br>
ğŸ‘Less access to main database, Less latency. Speed up!!<br>
ğŸ‘incoherent time happens for a while.<br>
âœ…**ã¾ãšã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥**ã¸æ›¸ãè¾¼ã¿ã€‚å¾Œã§ç©ºãæ™‚é–“ã§ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€æ–¹æ³•ã€‚<br>
âœ…æ›´æ–°å‡¦ç†ã®éš›ã«**ãƒ¡ãƒ¢ãƒªã«å¯¾ã™ã‚‹æ›´æ–°å‡¦ç†ã¯å¾…ã¤å¿…è¦ãŒãªã„ã€‚**


# ã§ã€WEBã‚¢ãƒ—ãƒªä½œã‚‹ä¸Šã§ã¯ã©ã†è€ƒãˆã¦ã„ãï¼Ÿ
## ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ã«ã¤ã„ã¦
ğŸ‘‰Write-throughæ–¹å¼ã‚’ä½¿ã†ã€‚<br>
ãƒ»**ã‚­ãƒ£ãƒƒã‚·ãƒ¥å†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¸¸ã«æœ€æ–°åŒ–ã™ã‚‹ã€‚**<br>
ã€€â€»ãƒ¦ãƒ¼ã‚¶ã‹ã‚‰ã™ã‚Œã°ã€writeå‡¦ç†ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ã‚‚ã®ã ã¨ç›´æ„Ÿçš„ã«æ„Ÿã˜ã¦ã„ã‚‹ãŸã‚ã€<br>
 ã€€ write-throughæ–¹å¼ã‚’ä½¿ã†ã“ã¨è‡ªä½“ã¯OKã€‚

ğŸ‘‰TTL(Time-to-Live)ã‚’è¨­å®šã™ã‚‹ã€‚<br>
ãƒ»ãã‚“ãªã«å‚ç…§ã•ã‚Œãªã„ãƒ‡ãƒ¼ã‚¿ã‚’Cachingã—ã¦ãŠãå¿…è¦ã¯ãªã„ã®ã§ã€è‡ªå‹•çš„ã«å‰Šé™¤ã•ã›ã‚‹ã€‚

## èªè¨¼æ¸ˆæƒ…å ±ã®ä¿ç®¡å ´æ‰€ã«ã¤ã„ã¦
### ã‚µãƒ¼ãƒå´ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆâ†’SessionStrage(Redisç­‰)ã«æ ¼ç´
âœ…Serverå´ã§Sessionã‚’ç”Ÿæˆâ†’SessionStorage(Redisç­‰)ã«ä¿ç®¡ï¼†Cookieã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDæ ¼ç´ãŒæ™®é€šã€‚â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚Cookieã«ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ï¼†SessionStorageã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ®‹ã£ã¦ã„ã‚‹é™ã‚Šã€ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¨ãªã‚‹ã€‚<br>
ã€€ãƒ»Amazonã¯ã“ã‚Œã€‚**ã‚µãƒ¼ãƒå´ã§èªè¨¼ã‚’è¡Œã†å ´åˆã¯ã“ã‚Œã«ãªã‚‹ã€‚**
